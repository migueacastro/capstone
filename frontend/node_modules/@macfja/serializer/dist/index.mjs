var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])},r(e,t)};var e=function(){return e=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o]);return r},e.apply(this,arguments)};function t(r,e,t){if(t||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return r.concat(n||Array.prototype.slice.call(e))}var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),o={},i=new Set,a={};function u(r){return void 0===r?"undefined":JSON.stringify(f(r,[]))}function c(r,e){if(void 0===e&&(e=void 0),"string"!=typeof r)return r;if(void 0===e&&(e={}),"undefined"!==r){e=Object.fromEntries(t(t([],Object.entries(e),!0),Object.entries(o),!0));try{return s(JSON.parse(r),e,{})}catch(e){return r}}}function f(r,t){if("string"==typeof r||"number"==typeof r&&!isNaN(r)&&Math.abs(r)!==1/0||null==r||"boolean"==typeof r)return r;var n=t.indexOf(r);if(-1!==n)return"#$@__instance__"+n;t.push(r);var o=t.length-1;if(r.constructor===Array){var u=r.map((function(r){return f(r,t)}));return u.unshift("#$@__reference__"+o),u}if(r.constructor===Object){var c=Object.fromEntries(Object.entries(r).map((function(r){return[r[0],f(r[1],t)]})));return c["#$@__reference__"]=o,c}i.add(r.constructor);var s={};s=Object.defineProperty(s,"#$@__constructor__",{value:r.constructor.name,enumerable:!0}),s=Object.defineProperty(s,"#$@__reference__",{value:o,enumerable:!0});var l=function(r,e){if(!Object.keys(a).includes(r.constructor.name))return;return a[r.constructor.name].toPlain(r,(function(r){return f(r,e)}))}(r,t);return void 0!==l?e(e({},l),s):(Object.getOwnPropertyNames(r).forEach((function(e){Object.defineProperty(s,e,{value:f(r[e],t),enumerable:!0})})),s)}function s(r,e,t){var o;if("string"==typeof r&&0===r.indexOf("#$@__instance__"))return t[f=parseInt(r.slice("#$@__instance__".length))];if("string"==typeof r||"number"==typeof r||null==r||"boolean"==typeof r)return r;if(r.constructor===Array){if(0===r.length)return[];var i=r.shift();if("string"!=typeof i||"#$@__reference__"!==i.substring(0,"#$@__reference__".length)){if(0===Object.keys(t).length)return r.unshift(i),r;throw new n}var u=[];t[f=i.slice("#$@__reference__".length)]=u;for(var c=0;c<r.length;c++)u[c]=s(r[c],e,t);return u}if(r.constructor===Object){var f;if(null===(f=null!==(o=r["#$@__reference__"])&&void 0!==o?o:null)){if(0===Object.keys(t).length)return r;throw new n}if(delete r["#$@__reference__"],!Object.keys(r).includes("#$@__constructor__")){u={};for(var l in t[f]=u,r)u[l]=s(r[l],e,t);return u}var _=r["#$@__constructor__"];delete r["#$@__constructor__"];var y=function(r,e,t,n){if(!Object.keys(a).includes(e))return;return a[e].fromPlain(r,(function(r){return s(r,t,n)}))}(r,_,e,t);if(void 0!==y)return y;if(!Object.keys(e).includes(_))throw new Error("The class "+_+" is not allowed");var p={};for(var l in t[f]=p,r)p[l]=s(r[l],e,t);return Object.setPrototypeOf(p,e[_].prototype),p}}function l(r){void 0===r&&(r=!1);var e=Array.from(i);return r&&_(),e}function _(){i.clear()}function y(r,e){void 0===e&&(e=!1);var n={};r.constructor===Array&&(n=Object.fromEntries(r.map((function(r){return[r.name,r]})))),"object"==typeof r&&(n=r),o=e?Object.fromEntries(t(t([],Object.entries(o),!0),Object.entries(n),!0)):n}function p(r){o[r.name]=r}function b(r,e,t){a[r]={toPlain:e,fromPlain:t}}!function(r,e){r("Date",(r=>({time:r.getTime()})),(function(r){let e=new Date;return e.setTime(r.time),e})),r("BigInt",(r=>({number:r.toString()})),(r=>BigInt(r.number))),r("String",(r=>({text:r.toString()})),(r=>new String(r.text))),r("RegExp",(r=>({source:r.source,flags:r.flags})),(r=>new RegExp(r.source,r.flags))),r("Number",(function(r){let e={nan:!1,infinity:!1,positive:!0,number:null};return Math.abs(r)===1/0?(e.infinity=!0,e.positive=Math.abs(r)===r,e):isNaN(r)?(e.nan=!0,e):(e.number=r.valueOf(),e)}),(function(r){return r.nan?NaN:r.infinity?1/0*(r.positive?1:-1):new Number(r.number)})),r("Map",((r,e)=>({data:Array.from(r.entries()).map((r=>e(r)))})),(function(r,e){const t=new Map;return r.data.map((r=>e(r))).forEach((([r,e])=>t.set(r,e))),t})),r("Set",((r,e)=>({data:Array.from(r.values()).map((r=>e(r)))})),(function(r,e){const t=new Set;return r.data.map((r=>e(r))).forEach((r=>t.add(r))),t})),r("ArrayBuffer",((r,e)=>({data:e(new Uint8Array(r))})),((r,e)=>e(r.data).buffer)),r("DataView",((r,e)=>({buffer:e(r.buffer),offset:r.byteOffset,length:r.byteLength})),((r,e)=>new DataView(e(r.buffer),r.offset,r.length))),[Error,EvalError,RangeError,AggregateError,ReferenceError,SyntaxError,TypeError,URIError,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array].forEach((r=>e(r)))}(b,p);export{b as addClassHandler,p as addGlobalAllowedClass,c as deserialize,l as getCollectedClasses,_ as resetCollectedClasses,u as serialize,y as setGlobalAllowedClasses};
